# 字符设备驱动开发
linux设备分类 字符设备（传输字符流，大部分设备是这个） 块设备（存储设备） 网络设备（socket设备套接字设备）
**用户层对驱动操作其实就是文件IO**
***驱动在liunx中使用时大致有如下分层
应用程序调用文件IO函数open这些->文件IO函数操作设备节点（比如dev/led0）->
进入内核层操作xxx_open，在用户层调用文件IO的open时，对应设备驱动也有个xxx_open函数 且内核中有设备号来区分***
## 字符驱动的要素
    1 必须有一个设备号，用在众多的设备驱动中进行区分
    2 用户必须知道设备驱动对应的设备节点（设备文件）
        linux把所有设备都看作文件
    3 对设备操作就是对文件操作，应用空间操作open这些函数时，实际在驱动代码中是
      有对应的open函数的xxx_open
***初学驱动开发，内核函数先学会用，等后续功力上升之后再看内核中是如何实现的***
## 申请设备号
    作为驱动必须有一个设备号，可以向系统申请
    设备号(32位)=主设备号（高12位）+次设备号（低20位）
    主设备号 表示一类设备
    次设备号 表示一类设备中的某一个（可以从0开始）
### 用到的函数
    int register_chrdev(unsigned int major, const char *name,
				  const struct file_operations *fops)
    第一个参数 主设备号 
        申请设备号有两种方式
        1 动态申请 参数1填写0 系统自动分配
        2 静态申请 指定一个整数（在12位的范围）
            但是有些设备号是已经被系统分配了，所以这个数字不能随便填写
    第二个参数 描述一个设备信息，可以自定义
    在/proc/devices会列举出所有已经注册的设备
    第三个参数 文件操作对象--驱动提供open read write
    返回值：正确返回0，错误返回负数
**cat /proc/devices 可以查看系统申请了那些设备还能看到已经占用的设备号**
























   
	



	
